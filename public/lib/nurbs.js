/*
This is a built version of nurbs (https://github.com/StandardCyborg/nurbs). The following is a copy of its license:

Copyright 2018 Standard Cyborg, Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

var nurbs=function(i){var e={};function n(t){if(e[t])return e[t].exports;var r=e[t]={i:t,l:!1,exports:{}};return i[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=i,n.c=e,n.d=function(i,e,t){n.o(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:t})},n.r=function(i){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n.t=function(i,e){if(1&e&&(i=n(i)),8&e)return i;if(4&e&&"object"==typeof i&&i&&i.__esModule)return i;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:i}),2&e&&"string"!=typeof i)for(var r in i)n.d(t,r,function(e){return i[e]}.bind(null,r));return t},n.n=function(i){var e=i&&i.__esModule?function(){return i.default}:function(){return i};return n.d(e,"a",e),e},n.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},n.p="",n(n.s=8)}([function(i,e,n){"use strict";var t=n(6),r=n(3),s=n(1);function o(i){if(i){if(t(i)||r(i))return"generic"===i.dtype?o.GENERIC_NDARRAY:o.NDARRAY;if(s(i))return o.ARRAY_OF_ARRAYS;throw new Error("Unhandled data type. Got type: "+typeof i)}}o.ARRAY_OF_ARRAYS="Arr",o.NDARRAY="Nd",o.GENERIC_NDARRAY="GenNd",o.PACKED="PackArr",i.exports=o},function(i,e,n){"use strict";i.exports=function(i){return Array.isArray(i)||ArrayBuffer.isView(i)}},function(i,e,n){"use strict";var t=function i(e,n){return function(n,t){void 0===n||Array.isArray(n)||(n=[n]);for(var r=[],s=0;s<n.length;s++)r.push(i.sum(n[s]));if(t)for(n=0;n<r.length;n++)void 0!==t[n]&&(r[n]="("+r[n]+" + "+t[n]+") % "+t[n]);return e+r.join("_")}};t.sum=function(i){return 0===(i=(i=Array.isArray(i)?i:[i]).filter(function(i){return void 0!==i&&0!==i})).length&&i.push(0),i.join(" + ")},i.exports=t},function(i,e){i.exports=function(i){return!!i&&(void 0!==i.data&&Array.isArray(i.shape)&&void 0!==i.offset&&void 0!==i.stride)}},function(i,e,n){var t=n(0);i.exports=function(i,e,n,r){var s,o=[];switch(t(r)){case t.NDARRAY:for(o.push("  var "+e+" = "+n+".data;"),o.push("  var "+e+"Offset = "+n+".offset;"),s=0;s<r.dimension;s++)o.push("  var "+e+"Stride"+s+" = "+n+".stride["+s+"];");break;case t.ARRAY_OF_ARRAYS:o.push("  var "+e+" = "+n+";")}return o.join("\n")}},function(i,e,n){"use strict";var t=n(3);i.exports=function(i,e,n){if(i){if(t(i))return e+".shape["+n+"]";for(var r=e,s=0;s<n;s++)r+="[0]";return r+".length"}return"this.size["+n+"]"}},function(i,e,n){"use strict";i.exports=function(i){return!!i&&(!!i.dtype&&new RegExp("function View[0-9]+d(:?"+i.dtype+")+").test(String(i.constructor)))}},function(i,e,n){"use strict";i.exports=function(i,e){for(var n=1,t=0,r=[];t<i.length;t++)n*=Array.isArray(i[t])?i[t][1]-i[t][0]:i[t],r[t]=Array.isArray(i[t])?i[t][0]:0;for(var s=0;s<n;s++)for(e(r.slice()),t=i.length-1;t>=0;t--){if(r[t]!==(Array.isArray(i[t])?i[t][1]:i[t])-1){r[t]++;break}r[t]=Array.isArray(i[t])?i[t][0]:0}}},function(i,e,n){"use strict";var t=n(0),r=n(9),s=n(6),o=n(3),a=n(10),u=n(11),h=n(1),f=n(12),c=n(13),d=n(14),l={open:"open",closed:"closed",clamped:"clamped"};function p(i){return void 0===i||null===i}function v(){var i,e=[],n=this.points;n?o(n)&&(i=n.shape):i=this.size;for(var t=0;t<this.splineDimension;t++){var r=i?i[t]:n.length,s=this.degree[t],a="closed"===this.boundary[t];if(this.knots&&this.knots[t]){var u=this.knots[t];e[t]=[u[a?0:s],u[r]]}else e[t]=[a?0:s,r];n&&(n=n[0])}return e}i.exports=function(i,e,n,o,g,m){var b=function(i,e,n,t,r,s){return y(i,e,n,t,r,s),b},y=function(i,e,n,o,v,g){var m,b;!i||h(i)||s(i)?(g=g||{},this.weights=o,this.knots=n,this.degree=e,this.points=i,this.boundary=v,this.debug=g.debug,this.checkBounds=!!g.checkBounds,Object.defineProperty(this,"size",{value:g.size,writable:!0,configurable:!0})):(g=i,this.debug=i.debug,this.checkBounds=!!i.checkBounds,this.weights=i.weights,this.knots=i.knots,this.degree=i.degree,this.boundary=i.boundary,this.points=i.points,Object.defineProperty(this,"size",{value:g.size,writable:!0,configurable:!0}));var y=t(this.points),A=t(this.weights),w=t(this.knots);if(this.points)switch(y){case t.GENERIC_NDARRAY:case t.NDARRAY:Object.defineProperties(this,{splineDimension:{value:this.points.shape.length-1,writable:!1,configurable:!0},dimension:{value:this.points.shape[this.points.shape.length-1],writable:!1,configurable:!0},size:{get:function(){return this.points.shape.slice(0,this.points.shape.length-1)},set:function(){throw new Error("Cannot assign to read only property 'size'")},configurable:!0}});break;case t.ARRAY_OF_ARRAYS:var R=0,k=this.size||[];k.length=0;for(var j=this.points;h(j[0]);j=j[0])R++,k.push(j.length);if(0===R)throw new Error("Expected an array of points");Object.defineProperties(this,{splineDimension:{value:R,writable:!1,configurable:!0},dimension:{value:j.length,writable:!1,configurable:!0},size:{get:function(){var i=[];i.length=0;for(var e=0,n=this.points;e<this.splineDimension;e++,n=n[0])i[e]=n.length;return i},set:function(){throw new Error("Cannot assign to read only property 'size'")},configurable:!0}});break;case t.PACKED:default:throw new Error("Expected either a packed array, array of arrays, or ndarray of points")}else{if(void 0===this.size||null===this.size)throw new Error("Either points or a control hull size must be provided.");if(h(this.size)||Object.defineProperty(this,"size",{value:[this.size],writable:!0,configurable:!0}),0===this.size.length)throw new Error("`size` must be a number or an array of length at least one.");Object.defineProperties(this,{splineDimension:{value:this.size.length,writable:!1,configurable:!0},dimension:{value:0,writable:!1,configurable:!0}})}if(h(this.degree)){for(m=0;m<this.splineDimension;m++)if(p(this.degree[m]))throw new Error("Missing degree in dimension "+(m+1))}else{var D=!p(this.degree),_=p(this.degree)?2:this.degree;for(this.degree=[],m=0;m<this.splineDimension;m++)if(this.size[m]<=_){if(D)throw new Error("Expected at least "+(_+1)+" points for degree "+_+" spline in dimension "+(m+1)+" but got only "+this.size[m]);this.degree[m]=this.size[m]-1}else this.degree[m]=_}if(b="string"!=typeof this.boundary?"open":this.boundary,!l[b])throw new Error("Boundary type must be one of "+Object.keys(l)+". Got "+b);for(this.boundary=h(this.boundary)?this.boundary:[],this.boundary.length=this.splineDimension,m=0;m<this.splineDimension;m++)if(this.boundary[m]=p(this.boundary[m])?b:this.boundary[m],!l[b])throw new Error("Boundary type must be one of "+Object.keys(l)+". Got "+b+" for dimension "+(m+1));switch(w){case t.ARRAY_OF_ARRAYS:for(h(this.knots)&&this.knots.length>0&&!h(this.knots[0])&&(this.knots=[this.knots]),m=0;m<this.splineDimension;m++){if(this.size[m]<=this.degree[m])throw new Error("Expected at least "+(this.degree[m]+1)+" points in dimension "+(m+1)+" but got "+this.size[m]+".");if(h(this.knots[m])){if("closed"!==this.boundary[m]&&this.knots[m].length!==this.degree[m]+this.size[m]+1)throw new Error("Expected "+(this.degree[m]+this.size[m]+1)+" knots in dimension "+(m+1)+" but got "+this.knots[m].length+".");if("closed"===this.boundary[m]&&this.knots[m].length!==this.size[m]+1&&this.knots[m].length!==this.size[m]+this.degree[m]+1)throw new Error("Expected "+(this.size[m]+1)+" knots for closed spline in dimension "+(m+1)+" but got "+this.knots[m].length+".")}}break;case t.NDARRAY:}var x=r(this,this.debug,this.checkBounds,y,A,w);if(x!==this.__cacheKey){this.__cacheKey=x;var E=a(this);this.evaluate=f(this.__cacheKey,this,E,this.debug,this.checkBounds,!1),this.transform=c(this.__cacheKey,this,E,this.debug),this.support=d(this.__cacheKey,this,E,this.debug,this.checkBounds),this.evaluator=function(i,e){return f(this.__cacheKey,this,E,this.debug,this.checkBounds,e,i)}}return this.numericalDerivative=u.bind(this),this}.bind(b);return Object.defineProperty(b,"domain",{get:v}),y(i,e,n,o,g,m),b}},function(i,e,n){"use strict";var t=n(1);function r(i){return i[0].toUpperCase()+i.slice(1)}i.exports=function(i,e,n,s,o,a){var u,h=[],f=!1;for(u=0;u<i.splineDimension;u++){var c=t(i.knots)&&t(i.knots[u]);c&&(f=!0),h.push("Deg"+i.degree[u]+(c?"":"Uniform")+r(i.boundary[u]))}var d=[[f?"NU":"",i.weights?"RBS":"BS"].join("")+i.dimension+"D",h.join("_")];return s&&d.push(s+"Pts"),o&&d.push(o+"Wts"),a&&d.push(a+"Kts"),e&&d.push("debug"),n&&d.push("chk"),d.join("_")}},function(i,e,n){"use strict";var t=n(0),r=n(2);function s(i){return function(e,n){void 0===e||Array.isArray(e)||(e=[e]);for(var t=[],s=0;s<e.length;s++)t.push(r.sum(e[s]));if(n)for(e=0;e<t.length;e++)void 0!==n[e]&&(t[e]="("+t[e]+" + "+n[e]+") % "+n[e]);return i(t)}}function o(i,e){var n;if(e)switch(t(e)){case t.ARRAY_OF_ARRAYS:return s(function(e){return i+"["+e.join("][")+"]"});case t.GENERIC_NDARRAY:return s(function(e){return i+".get("+e.join(",")+")"});case t.NDARRAY:return s(function(e){var t=[i+"Offset"];for(n=0;n<e.length;n++)t.push(i+"Stride"+n+" * ("+e[n]+")");return i+"["+t.join(" + ")+"]"});case t.PACKED:default:return}}i.exports=function(i){var e,n={};return(e=o("x",i.points))&&(n.point=e),(e=o("w",i.weights))&&(n.weight=e),(e=o("k",i.knots))&&(n.knot=e),n}},function(i,e,n){"use strict";var t=[],r=[];i.exports=function(i,e,n){if(1!==e)throw new Error("Numerical derivative not implemented for order n = "+e+".");var s,o=void 0===arguments[this.splineDimension+3]?1e-4:arguments[this.splineDimension+3];for(t.length=this.splineDimension,s=0;s<this.splineDimension;s++)t[s+1]=arguments[s+3];var a,u,h,f=this.domain,c=f[n][0],d=f[n][1],l=t[n+1],p=(d-c)*o;for("closed"===this.boundary[n]?(a=c+(l-c-p+(h=d-c))%h,u=c+(l-c+p+h)%h,p*=2):(a=Math.min(d,Math.max(c,l-p)),p=(u=Math.min(d,Math.max(c,l+p)))-a),t[n+1]=a,t[0]=r,this.evaluate.apply(null,t),t[n+1]=u,t[0]=i,this.evaluate.apply(null,t),s=0;s<this.dimension;s++)i[s]=(i[s]-r[s])/p;return i}},function(i,e,n){"use strict";var t=n(7),r=n(2),s=n(4),o=n(0),a=n(1),u=n(5),h={},f={};i.exports=function(i,e,n,c,d,l,p){var v,g,m,b,y,A,w=e.splineDimension,R=e.points,k=e.degree,j=e.weights,D=void 0!==j,_=e.knots,x=e.dimension,E=e.boundary;if(void 0!==p&&null!==p){Array.isArray(p)||(p=[p]);var z=0;for(v=0;v<w;v++)void 0===p[v]&&(p[v]=0),z+=p[v];if(D&&z>1)throw new Error("Analytical derivative not implemented for rational b-splines with order n = "+z+".")}l&&(i="Basis"+i),p&&(i="Der"+p.join("_")+"_"+i);var Y=h[i];if(c)var O="function"==typeof c?c:console.log;if(Y)return c&&O(f[i]),Y.bind(e);var N=[],S="evaluate"+i,P=n.point;l&&(P=function(i,e){for(var n=[],t=0;t<i.length;t++){for(var r=i[t],s=[],o=0;o<r.length;o++)0!==r[o]&&s.push(r[o]);r=s.join(" + "),e[t]&&(r="("+r+" + "+e[t]+") % "+e[t]),n.push(r+" === "+G(t))}return"(("+n.join(" && ")+") ? 1 : 0)"});var B=n.weight,F=n.knot,C=r("k"),K=r("x"),M=r("w"),G=r("i"),I=r("t"),U=c?"domain":"d",V=r(c?"size":"s"),T=r(c?"knotIndex":"j"),W=!0;for(y=0;y<w;y++)a(_)&&a(_[y])&&(W=!1);function q(i){N.push("  "+(i||""))}function H(i){c&&q(i)}if(l)var J=[];var L=[];for(v=0;v<w;v++)l&&J.push(G([v])),L.push(I([v]));for(N.push("function "+S+" ("+(l?"":"out, ")+L.join(", ")+(l?", "+J.join(", "):"")+") {"),q("var h, m, a, b;"),d&&(q("var "+U+" = this.domain;"),q("for (var i = 0; i < this.splineDimension; i++) {"),q("  a = arguments[i + 1];"),q("  if (a < "+U+"[i][0] || a > "+U+"[i][1] || a === undefined || isNaN(a)) {"),q("    throw new Error('Invalid Spline parameter in dimension '+i+'. Valid domain is ['+"+U+"[i][0]+', '+"+U+"[i][1]+']. but got t'+i+' = '+arguments[i + 1]+'.');"),q("  }"),q("}")),y=0;y<w;y++)q("var "+V(y)+" = "+u(R,"this.points",y)+";");function Q(i,e,n){return"("+i+") ? ("+e+") : ("+n+")"}N.push(s(e,"x","this.points",R)),D&&N.push(s(e,"w","this.weights",j)),W||N.push(s(e,"k","this.knots",_));var X=[];for(y=0;y<w;y++)switch(o(_)){case o.NDARRAY:X[y]=!0;break;case o.ARRAY_OF_ARRAYS:X[y]=a(_[y])}for(y=0;y<w;y++)if(X[y])for(H("\n  // Bisect to locate the knot interval in dimension "+y+"\n"),q("var "+T(y)+" = 0;"),q("h = "+V(y)+";"),q("while(h > "+T(y)+" + 1) {"),q("  m = 0.5 * (h + "+T(y)+") | 0;"),q("  if ("+F([y,"m"])+" > "+I(y)+") h = m;"),q("  else "+T(y)+" = m;"),q("}"),H("\n  // Fetch knots for dimension "+y+"\n"),v=1-k[y];v<=k[y];v++)"closed"===E[y]?q(v<0?"var "+C([y,v+k[y]-1])+" = "+Q(T(y)+" < "+-v,F([y,0])+" + "+F([y,[V(y),T(y),v]])+" - "+F([y,[V(y)]]),F([y,[T(y),v]]))+";":v>0?"var "+C([y,v+k[y]-1])+" = "+Q(T(y)+" + "+v+" > "+V(y),F([y,V(y)])+" + "+F([y,v+" + "+T(y)+" - "+V(y)])+" - "+F([y,0]),F([y,[T(y),v]]))+";":"var "+C([y,v+k[y]-1])+" = "+F([y,[T(y),v]])+";"):q("var "+C([y,v+k[y]-1])+" = "+F([y,[T(y),v]])+";");else{for(H("\n  // Directly compute knot interval for dimension "+y+"\n"),"closed"===E[y]?q(T(y)+" = ("+I(y)+" | 0) % "+V(y)+";"):(q(T(y)+" = ("+I(y)+" | 0);"),q("if ("+T(y)+" < "+k[y]+") "+T(y)+" = "+k[y]+";"),q("if ("+T(y)+" > "+V(y)+" - 1) "+T(y)+" = "+V(y)+" - 1;")),H("\n  // Compute and clamp knots for dimension "+y+"\n"),v=1-k[y];v<=k[y];v++)q("var "+(A=C([y,v+k[y]-1]))+" = "+T(y)+" + "+v+";");if("clamped"===E[y])for(v=1-k[y];v<=k[y];v++)A=C([y,v+k[y]-1]),v<0&&q("if ("+A+" < "+k[y]+") "+A+" = "+k[y]+";"),v>0&&q("if ("+A+" > "+V(y)+") "+A+" = "+V(y)+";");"closed"===E[y]&&(H("\n  // Wrap the B-Spline parameter for closed boundary"),q(I(y)+" %= "+V(y)+";"))}for(y=0,m=[];y<w;y++)m[y]=k[y]+1;for(D&&(H("\n  // Fetch weights\n"),t(m,function(i){for(var e=[],n=[],t=0;t<w;t++)e[t]=[T(t),i[t]-k[t]],"closed"===E[t]&&i[t]-k[t]<0&&(n[t]=V(t));q("var "+M(i)+" = "+B(e,n)+";")})),c&&q(D?"\n  // Fetch points and project into homogeneous (weighted) coordinates\n":"\n  // Fetch points\n"),t(m,function(i){for(var e=[],n=[],t=0;t<w;t++)e[t]=[T(t),i[t]-k[t]],"closed"===E[t]&&i[t]-k[t]<0&&(n[t]=V(t));if(l)q(D?"var "+K(i)+" = "+P(e,n)+" * "+M(i)+";":"var "+K(i)+" = "+P(e,n)+";");else for(t=0;t<x;t++){var r=i.concat(t);e[w]=t,q(D?"var "+K(r)+" = "+P(e,n)+" * "+M(i)+";":"var "+K(r)+" = "+P(e,n)+";")}}),H("\n"),H("// Perform De Boor's algorithm"),y=m.length-1;y>=0;y--)for(m[y]=[k[y],k[y]+1],v=0;v<k[y];v++)for(H("\n  // Degree "+k[y]+" evaluation in dimension "+y+", step "+(v+1)+"\n"),g=k[y];g>v;g--){var Z=p&&k[y]-v-p[y]<=0;Z?(q("m = 1 / ("+C([y,g-v+k[y]-1])+" - "+C([y,g-1])+");"),D&&(q("a = ("+I(y)+" - "+C([y,g-1])+") * m;"),q("b = 1 - a;"))):(q("a = ("+I(y)+" - "+C([y,g-1])+") / ("+C([y,g-v+k[y]-1])+" - "+C([y,g-1])+");"),q("b = 1 - a;")),D&&t(m,function(i){var e=i.slice(),n=i.slice();e[y]=g,n[y]=g-1,Z&&D&&q("h = "+M(e)+";"),q(M(e)+" = b * "+M(n)+" + a * "+M(e)+";")}),t(m,function(i){var e,n,t,r=i.slice(),s=i.slice();if(r[y]=g,s[y]=g-1,Z){var o=v+1;if(l)e=D?"h * "+M(s)+" / "+M(r)+" * ":"",n=K(r)+(D?" / h":""),t=K(s)+(D?" / "+M(s):""),q(K(r)+" = "+o+" * "+e+"("+n+" - "+t+") * m;");else{var a=r.slice(),u=s.slice();for(b=0;b<x;b++)a[w]=u[w]=b,e=D?"h * "+M(s)+" / "+M(r)+" * ":"",n=K(a)+(D?" / h":""),t=K(u)+(D?" / "+M(s):""),q(K(a)+" = "+o+" * "+e+"("+n+" - "+t+") * m;")}}else if(l)q(K(r)+" = b * "+K(s)+" + a * "+K(r)+";");else for(b=0;b<x;b++)r[w]=s[w]=b,q(K(r)+" = b * "+K(s)+" + a * "+K(r)+";")}),H("\n")}if(c&&q(D?"\n  // Project back from homogeneous coordinates and return final output\n":"\n  // Return final output\n"),l)q(D?"return "+K(k)+" / "+M(k)+";":"return "+K(k)+";");else for(y=0;y<x;y++)q(D?"out["+y+"] = "+K(k.concat([y]))+" / "+M(k)+";":"out["+y+"] = "+K(k.concat([y]))+";");if(l||q("return out;"),N.push("}"),c){var $=N.join("\n");O($),f[i]=$}var ii=new Function([N.join("\n"),"; return ",S].join(""))();return h[i]=ii,ii.bind(e)}},function(i,e,n){"use strict";var t={},r=n(4),s=n(5),o=n(2);i.exports=function(i,e,n,a){var u,h,f,c,d,l,p,v,g=t[i];if(g)return g.bind(e);var m=[],b="transform"+i;m.push("function "+b+"(m) {"),m.push("var i, w;"),m.push(r(e,"x","this.points",e.points));var y=o(a?"size":"s");for(u=0;u<e.splineDimension;u++)m.push("var "+y(u)+" = "+s(e.points,"this.points",u)+";");for(c=[],u=0;u<e.splineDimension;u++)f="i"+u,c.push(f),m.push("for ("+f+" = "+y(u)+"- 1; "+f+" >= 0; "+f+"--) {");for(u=0;u<e.dimension;u++)m.push("x"+u+" = "+n.point(c.concat([u])));for(d=[],u=0;u<e.dimension;u++)d.push("m["+((e.dimension+1)*(u+1)-1)+"] * x"+u);for(d.push("m["+((e.dimension+1)*(e.dimension+1)-1)+"]"),m.push("var w = ("+d.join(" + ")+") || 1.0;"),u=0;u<e.dimension;u++){for(d=[],l=e.dimension,h=0;h<l;h++)d.push("m["+(h*(l+1)+u)+"] * x"+h);d.push("m["+(h*(l+1)+u)+"]"),v=n.point(c.concat([u])),p="("+d.join(" + ")+") / w",m.push(v+" = "+p+";")}for(u=e.splineDimension-1;u>=0;u--)m.push("}");m.push("return this;"),m.push("}");var A=new Function([m.join("\n"),"; return ",b].join(""))();return a&&console.log(m.join("\n")),t[i]=A,A.bind(e)}},function(i,e,n){"use strict";var t=n(7),r=n(2),s=n(4),o=n(0),a=n(1),u=n(5),h={};i.exports=function(i,e,n,f,c){var d=h[i];if(d)return d.bind(e);var l,p,v,g=e.degree,m=e.knots,b=e.splineDimension,y=e.boundary,A=[],w="support"+i,R=n.knot,k=r("t"),j=f?"domain":"d",D=r(f?"size":"s"),_=r(f?"knotIndex":"i"),x=!0;for(v=0;v<b;v++)a(m)&&a(m[v])&&(x=!1);function E(i){A.push("  "+(i||""))}var z=[];for(l=0;l<b;l++)z.push(k([l]));A.push("function "+w+" (out, "+z.join(", ")+") {");var Y=0;function O(i,e){E(void 0===e?"out["+Y+++"] = "+i.join(" + ")+";":"out["+Y+++"] = ("+i.join(" + ")+" + "+e+") % "+e+";")}for(E("var h, m;"),E("var c = 0;"),c&&(E("var "+j+" = this.domain;"),E("for (var i = 0; i < this.splineDimension; i++) {"),E("  a = arguments[i + 1];"),E("  if (a < "+j+"[i][0] || a > "+j+"[i][1] || a === undefined || isNaN(a)) {"),E("    throw new Error('Invalid Spline parameter in dimension '+i+'. Valid domain is ['+"+j+"[i][0]+', '+"+j+"[i][1]+']. but got t'+i+' = '+arguments[i + 1]+'.');"),E("  }"),E("}")),v=0;v<b;v++)E("var "+D(v)+" = "+u(e.points,"this.points",v)+";");x||A.push(s(e,"k","this.knots",m));var N=[];for(v=0;v<b;v++)switch(o(m)){case o.NDARRAY:N[v]=!0;break;case o.ARRAY_OF_ARRAYS:N[v]=a(m[v])}for(v=0;v<b;v++)N[v]?(E("var "+_(v)+" = 0;"),E("h = "+D(v)+";"),E("while(h > "+_(v)+" + 1) {"),E("  m = 0.5 * (h + "+_(v)+") | 0;"),E("  if ("+R([v,"m"])+" > "+k(v)+") h = m;"),E("  else "+_(v)+" = m;"),E("}")):"closed"===y[v]?E(_(v)+" = ("+k(v)+" | 0) % "+D(v)+";"):(E(_(v)+" = ("+k(v)+" | 0);"),E("if ("+_(v)+" < "+g[v]+") "+_(v)+" = "+g[v]+";"),E("if ("+_(v)+" > "+D(v)+" - 1) "+_(v)+" = "+D(v)+" - 1;"));for(v=0,p=[];v<b;v++)p[v]=g[v]+1;t(p,function(i){for(var e=[],n=[],t=0;t<b;t++)e[t]=[_(t),i[t]-g[t]],"closed"===y[t]&&i[t]-g[t]<0&&(n[t]=D(t));for(t=0;t<b;t++)O(e[t],n[t])}),E("out.length = "+Y+";"),E("return out;"),A.push("}"),f&&console.log(A.join("\n"));var S=new Function([A.join("\n"),"; return ",w].join(""))();return h[i]=S,S.bind(e)}}]);